### Introduction
Within this repository, there will be a stand alone bash script designed to install an all-in-one Islandora stack upon any type of platform e.g Virtual Machine, bare metal server etc.

This document is for the evaluation and testing of Islandora but with the secondary purpose of explaining all involved installation steps for wider Islandora adoption and educational transparency.

### Document Maintainer
This document is being submitted to the Islandora DevOps Interest Group to demonstrate a base Islandora install as performed and agreed upon by the Islandora Community. Any feedback should be directed at the Islandora DevOps Interest Group at https://github.com/islandora-interest-groups/Islandora-DevOps-Interest-Group.

### Disclaimer
This documentation is provided by the Islandora DevOps Interest Group "as is" and "with all faults." Islandora DevOps makes no representations or warranties of any kind concerning the safety, suitability, inaccuracies, typographical errors, or other harmful components resulting from the use of this documentation or the software installed and referenced in the documentation. There are inherent dangers in the use of any software, and the user is solely responsible for determining whether this software product and this documentation is compatible with their equipment and other software installed on their equipment. Users are also solely responsible for the protection of their equipment and backup of their data, and Islandora DevOps will not be liable for any damages one may suffer in connection with using or modifying this documentation or referenced software.

### Index

* Server
* Script
* Install Dependencies and Pre-setup
* Environment
* OS
* Package Installation
* From Source
* ghostscript
* ffmpeg
* From Binaries
* ffmpeg2theora
* java
* Fits
* adore-djatoka
* drush
* Configuration
* OpenOffice
* Monit
* Apache and PHP
* Setup Databases
* Install Fedora Commons
* Fedora Commons Base Install
* XACML Settings
* GSearch and Solr
* GSearch Multithreading
* Adore-Djatoka
* Setup Logging
* Drupal Filter
* Install Drupal
* CLUI Config
* Islandora Modules
* Libraries
* Drupal site install
* Drush Enables and Configuration

### Server
This document is outlining a single (all-in-one) Islandora stack installation using Ubuntu 14.04 LTS system.

For general purpose repository sites, we recommend at minimum 2-4 CPU cores and 8GB-10GB of RAM.

This would be scaled up according to user-load, the type of derivative files being generated by the system (ie. creating web friendly version of archival quality images or video are quite processor intensive) and many other factors.  

### SSH keys
User accounts e.g. islandora  
Sudoers config (location, ideal setup)  
iptables (turn off for initial deploy?)  
Install Dependencies and Pre-setup   

### Environment
_created a islandora-install.properties file that should be removed or secured later_
<code>
cat ~/islandora-install.properties

    #!/bin/bash
    DB_SERVER="localhost"
    DB_ROOT_PASSWORD="password"            # Set MySQL root password -> keep it simple -> run mysql_secure_installation after install to secure mySQL
    DRUPAL_DB_NAME="drupal7"               # Drupal database name
    DRUPAL_DB_USER="drupal"                # Drupal username for settings.php file
    DRUPAL_DB_PASS="password"              # Drupal password for settings.php file
    DRUPAL_ADMIN_USER="admin"              # Drupal admin username to log into Drupal Site
    DRUPAL_ADMIN_PASS="password"           # Drupal admin password to log into Drupal Site
    DRUPAL_SITE_NAME="Islandora Install"   # Drupal site name - displayed on the web site
    FEDORA_VERSION="3.7.1"                 # Fedora version to install:  3.5 or 3.6.2 or 3.7.0 or 3.7.1
    FEDORA_DB_NAME="fedora3"               # Name of fedora MySQL database -> fedora3 is recommended
    FEDORA_DB_USER="fedoraAdmin"           # Fedora db username -> for fedora.fcfg file
    FEDORA_DB_PASS="password"              # Fedora db password -> for fedora.fcfg file
    FEDORA_ADMIN_USER="fedoraAdmin"        # Username for http://localhost:8080/fedora/admin
    FEDORA_ADMIN_PASS="password"           # Password for http://localhost:8080/fedora/admin
    FEDORA_USER="fedora"                   # User that tomcat runs as
    FEDORA_HOME="/usr/local/fedora"        # Fedora home dir
    CATALINA_HOME="$FEDORA_HOME/tomcat"    # Tomcat location
    # NOTE adjust memory so that it is no larger than half of total system memory. Depending on stack deployment this can be adjusted further. Donâ€™t recommend running stack on system with less than 4GB of ram
    JAVA_OPTS="-Xms3072m -Xmx3072m -XX:MaxPermSize=512m -XX:+CMSClassUnloadingEnabled -  Djavax.net.ssl.trustStore=/usr/local/fedora/server/truststore -Djavax.net.ssl.trustStorePassword=tomcat -Dsolr.solr.home=/usr/local/fedora/solr -Dkakadu.home=/opt/adore-djatoka/bin/Linux-x86-64 -Djava.library.path=/opt/adore-djatoka/lib/Linux-x86-64 -DLD_LIBRARY_PATH=/opt/adore-djatoka/lib/Linux-x86-64"
    JAVA_HOME=/usr/lib/jvm/java-7-oracle/jre  
    # Moved this down below java install please change to match java version
    TOMCAT_BASE="http://localhost:8080"
    ISLANDORA_BASE="$TOMCAT_BASE/fedora"
    SOLR_BASE="$TOMCAT_BASE/solr"
    ISLANDORA_BRANCH="7.x"
    TUQUE_BRANCH="1.x"
    ERROR_LEVEL="2"
    FEDORA_GSEARCH_URL="http://downloads.sourceforge.net/fedora-commons/fedoragsearch-2.7.1.zip"
    FEDORA_GSEARCH_NAME="fedoragsearch-2.7.1"
    SOLR_VERSION="4.2.0"
    NUMBER_OF_GSEARCH_THREADS="2"          #do one gsearch thread per cpu might want to skip multithreading if you only have 1 cpu
    GSEARCH_UPDATER_NAMES="FgsUpdaters FgsUpdater1"
    DRUPAL_FILTER_URL="https://github.com/Islandora/islandora_drupal_filter/releases/download/v7.1.3/fcrepo-drupalauthfilter-3.7.1.jar"
    SOLR_URL="http://archive.apache.org/dist/lucene/solr/4.2.0/solr-4.2.0.tgz"
    SOLR_NAME="solr-4.2.0"
    SOLR_DEFAULT_CORE_PATH="collection1"

    Q1="CREATE DATABASE IF NOT EXISTS $DRUPAL_DB_NAME CHARACTER SET utf8 COLLATE utf8_bin;"
    Q2="GRANT ALL ON $DRUPAL_DB_NAME.* TO $DRUPAL_DB_USER@localhost IDENTIFIED BY '$DRUPAL_DB_PASS';"
    Q3="CREATE DATABASE IF NOT EXISTS $FEDORA_DB_NAME CHARACTER SET utf8 COLLATE utf8_bin;"
    Q4="GRANT ALL ON $FEDORA_DB_NAME.* TO $FEDORA_DB_USER@localhost IDENTIFIED BY '$FEDORA_DB_PASS';"
    Q5="FLUSH PRIVILEGES;"
    SQL="${Q1}${Q2}${Q3}${Q4}${Q5}"

    APACHE_DEFAULT_SITE="000-default"
    APC_CONFIG_FILE="/etc/php5/mods-available/apcu.ini"
    PROXY_DJATOKA_CONFIG="/etc/apache2/conf-available/proxy_djatoka.conf"
    APACHE_USER="www-data"
    APACHE_SERVICE="apache2"
    OS_DEFAULT_DOCUMENTROOT="/var/www"
    SCHEDULE_TOMCAT_SERVICE_COMMAND="update-rc.d tomcat start 95 2 3 4 5 . stop 15 0 1 6 ."
    SCHEDULE_OPENOFFICE_SERVICE_COMMAND="update-rc.d openoffice start 92 2 3 4 5 . stop 30 0 1 6 ."
    CRON_SPOOL_DIR="/var/spool/cron/crontabs"
    MONIT_CONF_DIR="/etc/monit/conf.d"
    MONIT_CONFIG_FILE="/etc/monit/monitrc"
</code>

Source environment _(Please note: this must be redone if you close your shell mid-install)_
<code>chmod +x ~/islandora-install.properties</code>

<code>. ~/islandora-install.properties</code>

### Operating System
Ensure latest core os updates  

<code>apt-get update && apt-get upgrade</code>

Add repo to easily obtain oracle java installer.  

<code>apt-get -y install python-software-properties && add-apt-repository -y ppa:webupd8team/java && apt-get -y update</code>

Add optional multiverse repos in /etc/apt/sources.list  

Uncomment each line in this file that ends in multiverse.

Software Dependencies installed by Apt-Get Package Manager
_accept license agreement and enter root password when asked_

<code>apt-get -y install oracle-java7-installer libjpeg-dev libpng12-dev libtiff4-dev php5 php5-cli php5-curl php5-dev php5-gd php5-ldap php5-mysql php5-xsl php-apc php-soap php-xml-htmlsax3 php-xml-parser php-xml-rpc php-xml-rpc2 php-xml-rss php-xml-serializer php5-imagick php5-mcrypt php-xml* mysql-server vim curl apache2 rsync wget imagemagick ant libimage-exiftool-perl unzip lame autoconf build-essential checkinstall git libass-dev libfaac-dev libgpac-dev libmp3lame-dev libopencore-amrnb-dev libopencore-amrwb-dev librtmp-dev libtheora-dev libtool libvorbis-dev pkg-config texi2html zlib1g-dev ffmpeg2theora poppler-utils python-pip libreoffice libreoffice-writer libreoffice-calc libreoffice-impress libreoffice-draw bibutils ufraw links monit tesseract-ocr tesseract-ocr-eng tesseract-ocr-fra tesseract-ocr-spa tesseract-ocr-ita tesseract-ocr-por tesseract-ocr-hin tesseract-ocr-deu tesseract-ocr-jpn tesseract-ocr-rus</code>

### Software Dependencies compiled from Source  

<b>ghostscript</b>  

_Please note: ubuntu 14.04 installs ghostscript 9.10 which is currently failing our test sets and prevents tiffs from being generated from pdfs. Recommend installing from source to get correct version_

<code>wget http://downloads.ghostscript.com/public/ghostscript-9.05.tar.gz</code>

<code>tar xvzf ghostscript-9.05.tar.gz</code>

<code>cd ghostscript-9.05</code>
  
<code>./configure</code>
 
<code>make && make install</code> 


_should return result_  

<code>gs --version</code>

<b>ffmpeg</b>  

<code>mkdir ~/ffmpeg-source</code> 
<code>cd ~/ffmpeg-source</code>

_yasm_  

<code>wget http://www.tortall.net/projects/yasm/releases/yasm-1.2.0.tar.gz</code>

<code>tar xzvf yasm-1.2.0.tar.gz && rm -rf yasm-1.2.0.tar.gz</code>  

<code>cd yasm-1.2.0</code>  

<code>./configure</code>  

<code>make</code>

<code>checkinstall --pkgname=yasm --pkgversion="1.2.0" --backup=no --deldoc=yes --fstrans=no --default</code>

_x264_  

<code>cd ~/ffmpeg-source</code>

<code>git clone --depth 1 git://git.videolan.org/x264.git</code> 

<code>cd x264</code>  

<code>./configure --enable-static --enable-shared</code>  

<code>make</code>  

<code>checkinstall --pkgname=x264 --pkgversion="3:$(./version.sh | awk -F'[" ]' '/POINT/{print $4"+git"$5}')" --backup=no --deldoc=yes  --fstrans=no --default</code>  

<code>ldconfig</code>  

<code>cd ~/ffmpeg-source</code>

_aac_  

<code>git clone --depth 1 git://github.com/mstorsjo/fdk-aac.git</code>  

<code>cd fdk-aac</code>  

<code>autoreconf -fiv</code>  

<code>./configure --disable-shared</code>  

<code>make</code>  

<code>checkinstall --pkgname=fdk-aac --pkgversion="$(date +%Y%m%d%H%M)-git" --backup=no --deldoc=yes --fstrans=no --default</code>

_libvpx_ 
 
<code>cd ~/ffmpeg-source</code>  

<code>git clone https://chromium.googlesource.com/webm/libvpx.git</code>  

<code>cd libvpx</code>

<code>git checkout 8366a6e4ba95e6d5af040815d2afbb4bfe628d3f</code>

<code>./configure --disable-examples --disable-unit-tests</code>  

<code>make</code>  

<code>checkinstall --pkgname=libvpx --pkgversion="1:$(date +%Y%m%d%H%M)-git" --backup=no --deldoc=yes --fstrans=no --default</code>

_opus_  

<code>cd ~/ffmpeg-source</code>  

<code>git clone --depth 1 git://git.xiph.org/opus.git</code>  

<code>cd opus</code>  

<code>./autogen.sh</code>  

<code>./configure --disable-shared</code>  

<code>make</code>  

checkinstall --pkgname=libopus --pkgversion="$(date +%Y%m%d%H%M)-git" --backup=no --deldoc=yes --fstrans=no --default  
</code>

_ffmpeg_  

<code>
cd ~/ffmpeg-source  

wget http://www.ffmpeg.org/releases/ffmpeg-1.1.1.tar.gz  

tar xf ffmpeg-1.1.1.tar.gz && rm -rf ffmpeg-1.1.1.tar.gz  

cd ffmpeg-1.1.1  
</code>

_had to do this to remove strange characters that cause build errors_ 
 
<code>sed -i 's/Ã—/x/' doc/filters.texi</code>  

<code>sed -i 's/Ã—/x/' doc/ffmpeg.texi</code>  

<code>./configure --enable-gpl --enable-libass --enable-libfaac --enable-libfdk-aac --enable-libmp3lame --enable-libopencore-amrnb --enable-libopencore-amrwb --enable-librtmp --enable-libtheora --enable-libvorbis --enable-libvpx --enable-libx264 --enable-nonfree --enable-version3 --enable-libopus</code>  

<code>make</code>

<code>checkinstall --pkgname=ffmpeg --pkgversion="7:$(date +%Y%m%d%H%M)-git" --backup=no --deldoc=yes --fstrans=no --default</code>  

<code>make install</code>  

<code>hash -r</code>

_The following should tell apt to not upgrade ffmpeg - we need version 1.1.1_  

<code>apt-mark hold ffmpeg  </code>

_Cleanup ffmpeg source code_  

<code>ffmpeg -version && cd ~ && rm -rf ~/ffmpeg-source  </code>

### Software Dependencies install by Binaries
<b>ffmpeg2theora</b>  

<code>cd ~ && wget http://v2v.cc/~j/ffmpeg2theora/ffmpeg2theora-0.29.linux64.bin && chmod a+x ffmpeg2theora-0.29.linux64.bin && install -m 755 ffmpeg2theora-0.29.linux64.bin /usr/bin/ffmpeg2theora && rm -rf ffmpeg2theora-0.29.linux64.bin</code>  

<b>java</b>  
_Now that java is installed, we can set JAVA_HOME and also add it to ~/islandora-install.properties_ 
 
<code>echo $( dirname $( dirname $( readlink -e /usr/bin/java ) ) )  </code>

_Should match the oracle java not openjdk_  

Update ~/islandora-install.properties to match proper java version  

_For example_  

<code>JAVA_HOME=/usr/lib/jvm/java-7-oracle/jre</code>  

_And source again if necessary_ 
 
<code>. ~/islandora-install.properties</code>

_Note you need to ensure that your update-alternatives point to the right java and javac_  

<code>update-alternatives --config java</code>  

<code>update-alternatives --config javac</code>

<b>Fits</b>  

<code>cd /opt</code>  

<code>wget http://fits.googlecode.com/files/fits-0.6.2.zip</code>  

<code>unzip -o fits-0.6.2.zip && rm -rf fits-0.6.2.zip && ln -s fits-0.6.2 fits && chmod a+x /opt/fits/fits.sh</code>

<b>adore-djatoka</b> 
 
<code>cd /opt</code>  

<code>wget http://sourceforge.net/projects/djatoka/files/djatoka/1.1/adore-djatoka-1.1.tar.gz/download -O adore-djatoka-1.1.tar.gz</code>  

<code>tar xf adore-djatoka-1.1.tar.gz && rm -rf adore-djatoka-1.1.tar.gz</code>  

<code>ln -s adore-djatoka-1.1 adore-djatoka</code>

_Make kakadu available on the command line_  

<code>ln -s /opt/adore-djatoka/bin/Linux-x86-64/kdu_expand /usr/bin/kdu_expand</code>  

<code>ln -s /opt/adore-djatoka/bin/Linux-x86-64/kdu_compress /usr/bin/kdu_compress</code>  

<code>echo "/opt/adore-djatoka/lib/Linux-x86-64" > /etc/ld.so.conf.d/kakadu.conf</code>  

<code>ldconfig</code>

<b>Drush</b>  

_Specify drush commit due to issues with newer drush versions and automated tests used by QA_

<code>cd /opt</code>  

<code>git clone https://github.com/drush-ops/drush.git && cd drush && git checkout b9e6c8c00da0fbf1227869cdf915b0c6cea466cc</code>  

<code>ln -s /opt/drush/drush /usr/bin/drush</code>

### Configurations  

<b>OpenOffice</b>  

<code>cd /etc/init.d && wget --no-check-certificate https://raw.github.com/discoverygarden/openoffice-init-script/master/openoffice && chmod a+x openoffice</code>  

<code>useradd -m -d /home/openoffice openoffice</code>   

<code>service openoffice start</code> 

<code>echo -e "check process openoffice\n        matching \"/usr/lib/libreoffice/program/soffice.bin\"\n        start program = \"/etc/init.d/openoffice start\"\n        stop program = \"/etc/init.d/openoffice stop\"\n        if failed host 127.0.0.1 port 8100 then restart\n        if 5 restarts within 5 cycles then timeout" > $MONIT_CONF_DIR/openoffice.conf</code>

<b>Monit</b>
_Keep openoffice running as a service with Monit as it has been known to crash._  

<code>$SCHEDULE_OPENOFFICE_SERVICE_COMMAND</code>  

<code>sed -i 's|# set httpd| set httpd|g' $MONIT_CONFIG_FILE</code>  

<code>sed -i 's|#    use address|    use address|g' $MONIT_CONFIG_FILE</code>  

<code>sed -i 's|#    allow localhost|    allow localhost|g' $MONIT_CONFIG_FILE</code>  

<code>sed -i 's|    allow admin:monit|#    allow admin:monit|g' $MONIT_CONFIG_FILE</code>  

<code>sed -i 's|    allow @monit |#    allow @monit |g' $MONIT_CONFIG_FILE</code>  

<code>sed -i 's|    allow @users readonly |#    allow @users readonly |g' $MONIT_CONFIG_FILE</code>  

<code>service monit restart</code>

<b>Apache and PHP</b>  

_Setup apache vhost_  

<code>vi /etc/apache2/sites-available/000-default.conf</code>

<code><VirtualHost *:80>
        ServerAdmin webmaster@localhost

        DocumentRoot /var/www/drupal7
        <Directory />
                Options FollowSymLinks
                AllowOverride None
        </Directory>
        <Directory /var/www/drupal7/>
                Options Indexes FollowSymLinks MultiViews
                AllowOverride all
                Order allow,deny
                allow from all
        </Directory>

        ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
        <Directory "/usr/lib/cgi-bin">
                AllowOverride None
                Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
                Order allow,deny
                Allow from all
        </Directory>

        ErrorLog ${APACHE_LOG_DIR}/error.log

        # Possible values include: debug, info, notice, warn, error, crit,
               # alert, emerg.
               LogLevel warn

               CustomLog ${APACHE_LOG_DIR}/access.log combined

           Alias /doc/ "/usr/share/doc/"
           <Directory "/usr/share/doc/">
               Options Indexes MultiViews FollowSymLinks
               AllowOverride None
               Order deny,allow
               Deny from all
               Allow from 127.0.0.0/255.0.0.0 ::1/128
           </Directory>

               ProxyPass /adore-djatoka http://localhost:8080/adore-djatoka
               ProxyPassReverse /adore-djatoka http://localhost:8080/adore-djatoka

</VirtualHost></code>

<code>a2enmod rewrite</code>  

<code>a2enmod proxy</code>  

<code>a2enmod proxy_http</code>  

<code>pecl install uploadprogress</code>  

<code>sed -i '949iextension=uploadprogress.so' /etc/php5/apache2/php.ini</code>  

<code>sed -i "s|memory_limit = 128M|memory_limit = 512M|g" /etc/php5/apache2/php.ini</code>  

<code>sed -i "s|post_max_size = 8M|post_max_size = 2048M|g" /etc/php5/apache2/php.ini</code>  

<code>sed -i "s|upload_max_filesize = 2M|upload_max_filesize = 2048M|g" /etc/php5/apache2/php.ini</code>  

<code>echo "apc.shm_size = 64M" >> $APC_CONFIG_FILE</code>

<b>Setup MySQL Databases and Server</b>  

_Run mysql_secure_installation to ensure security_
  
<code>MYSQL=`which mysql`</code>  

<code>$MYSQL -uroot -p$DB_ROOT_PASSWORD -e "$SQL"  </code>

_Add a mysql backup script_  

<code>if [ ! -d /root/bin ]; then
  mkdir -p /root/bin
  fi  
  echo -e '#!/bin/bash\n#\n# Dumps all MySQL databases and removes backups older than 1 week\n# With optional scp to another host\n\nBackupFolder=/dbbackups\nMySQLUser=root\nMySQLPass=PASSWORD\n# These next few are just used for scp, which is optional if DO_SCP != yes\nDO_SCP=no\nREMOVE_LOCAL_COPY=no\nFOLDER=dbBACK/mysql-newdb\nBACKUP_USER=backupuser\nBACKUP_HOST=backuppass\n\nDATE=$(date +%Y%m%d)\nOLDDATE=$(date +%Y%m%d -d ' 7 days ago')\n\nif [ ! -d "$BackupFolder" ]; then\n        mkdir -p "$BackupFolder"\n        if [ $? -gt 0 ]; then\n                echo "ERROR: Could not create $BackupFolder"\n                exit 1\n        fi\nfi\n\nfor dbname in $(mysql --user="$MySQLUser" --password="$MySQLPass" -Bse "show databases"); do\n  rm -f "$BackupFolder/$dbname-$OLDDATE.bz2"\n  DumpName="$BackupFolder/$dbname-$DATE.bz2"\n  mysqldump --user="$MySQLUser" --password="$MySQLPass" --opt "$dbname" | bzip2 -9 >"$DumpName"\n  if [ $? -gt 0 ]; then\n        echo "Backup of $dbname failed! (mysqldump)"\n  else\n        if [ "$DO_SCP" == 'yes' ]; then\n            scp -B -o StrictHostKeyChecking=no "$DumpName" "$BACKUP_USER"@"$BACKUP_HOST":"$FOLDER/"\n            if [ $? -gt 0 ]; then\n                echo "Backup of $dbname failed! (scp)"\n            fi\n            if [ "$REMOVE_LOCAL_COPY" == 'yes' ]; then\n                rm -f "$DumpName"\n            fi\n        fi\n  fi\ndone\n' > /root/bin/mysqlBackup.sh && chmod a+x</code>

<code>/root/bin/mysqlBackup.sh</code>  

<code>sed -i "s|PASSWORD|$DB_ROOT_PASSWORD|g" /root/bin/mysqlBackup.sh</code>
  
_Update crontab to schedule mysql backup_  

<code>crontab -e</code>  

_Add_
  
<code>15 1 * * * /root/bin/mysqlBackup.sh</code>

<code>mkdir -p /dbbackups</code> 

_Dumps will be stored in /dbbackups_  

### Install Fedora Commons

<b>Fedora Commons Base Install</b>  

_Create install properties file_  

<code>cd ~</code>  

<code>echo -e 'keystore.file=included\nri.enabled=true\nmessaging.enabled=true\napia.auth.required=false\ndatabase.jdbcDriverClass=com.mysql.jdbc.Driver\ntomcat.ssl.port=8443\nssl.available=true\ndatabase.jdbcURL=jdbc\:mysql\://localhost/fedora3?useUnicode\=true&amp;characterEncoding\=UTF-8&amp;autoReconnect\=true\nmessaging.uri=vm\:(broker\:(tcp\://localhost\:61616))\ndatabase.password=islandora\ndatabase.mysql.driver=included\ndatabase.username=fedoraAdmin\nfesl.authz.enabled=false\ntomcat.shutdown.port=8055\ndeploy.local.services=true\nxacml.enabled=true\ndatabase.mysql.jdbcDriverClass=com.mysql.jdbc.Driver\ntomcat.http.port=8080\nfedora.serverHost=localhost\ndatabase=mysql\ndatabase.driver=included\nfedora.serverContext=fedora\nllstore.type=akubra-fs\ntomcat.home=/usr/local/fedora/tomcat\nfesl.authn.enabled=true\ndatabase.mysql.jdbcURL=jdbc\:mysql\://localhost/fedora3?useUnicode\=true&amp;characterEncoding\=UTF-8&amp;autoReconnect\=true\nfedora.home=/usr/local/fedora\ninstall.type=custom\nservlet.engine=included\napim.ssl.required=false\nfedora.admin.pass=islandora\napia.ssl.required=false' > ~/install.properties</code>

<code>sed -i "s|localhost/fedora3?|localhost/$FEDORA_DB_NAME?|g" ~/install.properties</code>  

<code>sed -i "s|database.password=islandora|database.password=$FEDORA_DB_PASS|g" ~/install.properties</code>  

<code>sed -i "s|database.username=fedoraAdmin|database.username=$FEDORA_DB_USER|g" ~/install.properties</code>  

<code>sed -i "s|fedora.home=/usr/local/fedora|fedora.home=$FEDORA_HOME|g" ~/install.properties</code>  

<code>sed -i "s|tomcat.home=/usr/local/fedora/tomcat|tomcat.home=$CATALINA_HOME|g" ~/install.properties</code>

<code>sed -i "s|fedora.admin.pass=islandora|fedora.admin.pass=$FEDORA_ADMIN_PASS|g" ~/install.properties</code>

<code>cd ~</code>  

<code>wget http://downloads.sourceforge.net/fedora-commons/fcrepo-installer-$FEDORA_VERSION.jar</code>  

<code>java -jar fcrepo-installer-$FEDORA_VERSION.jar install.properties</code>  

<code>rm -rf fcrepo-installer-$FEDORA_VERSION.jar install.properties</code>  

<code>sed -i "s|changeme|islandora|g" $FEDORA_HOME/server/config/fedora.fcfg</code> 

_Tweak some fedora settings_ 
 
<code> sed -i 's|<param name="bufferSafeCapacity" value="40000">|<param name="bufferSafeCapacity" value="80000">|g' $FEDORA_HOME/server/config/fedora.fcfg</code>  

<code>sed -i 's|<param name="bufferFlushBatchSize" value="20000">|<param name="bufferFlushBatchSize" value="40000">|g' $FEDORA_HOME/server/config/fedora.fcfg</code>  

<code>sed -i 's|<param name="autoFlushBufferSize" value="20000">|<param name="autoFlushBufferSize" value="40000">|g' $FEDORA_HOME/server/config/fedora.fcfg</code>  

<code>sed -i "s|security.fesl.authN.jaas.apia.enabled=false|security.fesl.authN.jaas.apia.enabled=true|g" $FEDORA_HOME/server/config/spring/web/web.properties</code> 

_Adds Fedora User and adds fedora environment variables to /etc/profile.d/fedora.sh_  

</code>FEDORA_USER_TEST=`getent passwd $FEDORA_USER`</code>

<code>if [ "$FEDORA_USER_TEST" = "" ]; then</code>  
  <code>useradd -m -d $FEDORA_HOME -s /bin/false $FEDORA_USER  
  <code>`# Make environment variables match with what we set above`</code>  
  <code>echo -e 'export FEDORA_HOME=/usr/local/fedora\nexport CATALINA_HOME=/usr/local/fedora/tomcat\nexport CATALINA_PID="$CATALINA_HOME/catalina.pid"\nexport JAVA_OPTS="-Xms1024m -Xmx1024m -XX:MaxPermSize=512m -XX:+CMSClassUnloadingEnabled -Djavax.net.ssl.trustStore=/usr/local/fedora/server/truststore -Djavax.net.ssl.trustStorePassword=tomcat"\nexport JAVA_HOME=/usr/lib/jvm/java-7-oracle/jre\nexport FEDORA_USER=fedora' > /etc/profile.d/fedora.sh</code>
  <code>sed -i "s|JAVA_OPTS=\"-Xms1024m -Xmx1024m -XX:MaxPermSize=512m -XX:+CMSClassUnloadingEnabled -Djavax.net.ssl.trustStore=/usr/local/fedora/server/truststore -Djavax.net.ssl.trustStorePassword=tomcat\"|JAVA_OPTS=\"$JAVA_OPTS\"|g" /etc/profile.d/fedora.sh</code>
   <code>sed -i "s|FEDORA_HOME=\"/usr/local/fedora\"|FEDORA_HOME=\"$FEDORA_HOME\"|g" /etc/profile.d/fedora.sh</code>
   <code>sed -i "s|CATALINA_HOME=\"/usr/local/fedora/tomcat\"|CATALINA_HOME=\"$CATALINA_HOME\"|g"</code> /etc/profile.d/fedora.sh</code>
   <code>sed -i "s|FEDORA_USER=fedora|FEDORA_USER=$FEDORA_USER|g" /etc/profile.d/fedora.sh</code>
   <code>sed -i "s|JAVA_HOME=/usr/lib/jvm/java-7-oracle/jre|JAVA_HOME=$JAVA_HOME|g"</code> /etc/profile.d/fedora.sh</code>  
 <code>else</code>  
 <code>echo -e "fedora user already exists\n"</code> 
 <code>fi</code>
 
_Note: make sure you check /etc/profile.d/fedora.sh to ensure everything has been generated properly. If it didnâ€™t you may have closed your shell you may need to resource islandora-install.properties_  

_For example:_  

<code>export FEDORA_HOME=/usr/local/fedora</code>
<code>export CATALINA_HOME=/usr/local/fedora/tomcat</code>
<code>export CATALINA_PID="$CATALINA_HOME/catalina.pid"</code>
<code>export JAVA_OPTS="-Xms3993m -Xmx3993m -XX:MaxPermSize=512m -XX:+CMSClassUnloadingEnabled -Djavax.net.ssl.trustStore=/usr/local/fedora/server/truststore -Djavax.net.ssl.trustStorePassword=tomcat"</code>
<code>export JAVA_HOME=/usr/lib/jvm/java-7-oracle/jre</code>

<code>chown -R $FEDORA_USER:$FEDORA_USER $FEDORA_HOME</code>

_Create tomcat init.d startup script_  

<code>cd /etc/init.d</code>  

<code>wget --no-check-certificate https://raw.github.com/discoverygarden/Fedora-Init-Script/master/tomcat</code>  

<code>ln -s tomcat fedora</code>  

<code>chmod a+x tomcat</code>  

<code>$SCHEDULE_TOMCAT_SERVICE_COMMAND</code>  

<code>unzip -o $CATALINA_HOME/webapps/fedora.war -d $CATALINA_HOME/webapps/fedora</code>

_Fix for fedora 3.7.1 -> note tagged file for 3.7.1 doesnâ€™t seem to work_ 
 
<code>mkdir -p $CATALINA_HOME/webapps/fedora/WEB-INF/classes/org/fcrepo/server/storage/resources</code>  

<code>cd $CATALINA_HOME/webapps/fedora/WEB-INF/classes/org/fcrepo/server/storage/resources</code>   

<code>wget --no-check-certificate https://raw.githubusercontent.com/fcrepo3/fcrepo/6a4681c1229682d865f51ace194f20156ff48301/fcrepo-server/src/main/resources/dbspec/server/org/fcrepo/server/storage/resources/DefaultDOManager.dbspec</code>   

<code>chown -R $FEDORA_USER:$FEDORA_USER $FEDORA_HOME</code>

_Start and stop tomcat so fedora creates some dirs_  

<code>service tomcat deploy</code>

### XACML Settings

_Adjust xacml policies..._ 
 
<code>rm -rf $FEDORA_HOME/data/fedora-xacml-policies/repository-policies/default/deny-purge-*</code>  

<code>rm -rf $FEDORA_HOME/data/fedora-xacml-policies/repository-policies/default/deny-inactive-or-deleted-objects-or-datastreams-if-not-administrator.xml</code>  

<code>rm -rf $FEDORA_HOME/data/fedora-xacml-policies/repository-policies/default/deny-policy-management-if-not-administrator.xml  </code>

_Note this file should either be removed or tweaked if you wish to access fedoraAdmin. Keep in mind firewall rules would need to be updated as well._

<code>rm -rf $FEDORA_HOME/data/fedora-xacml-policies/repository-policies/default/deny-apim-if-not-localhost.xml</code>  

<code>cd ~</code>  

<code>git clone https://github.com/Islandora/islandora-xacml-policies && cd islandora-xacml-policies</code>  

<code>mkdir $FEDORA_HOME/data/fedora-xacml-policies/repository-policies/islandora_policies && cp *.xml $FEDORA_HOME/data/fedora-xacml-policies/repository-policies/islandora_policies && rm -rf ~/islandora-xacml-policies</code>

### GSearch and Solr

_Grab fedoragsearch and solr - do basic config_  

<code>cd ~</code>  

<code>wget $FEDORA_GSEARCH_URL</code>  

<code>unzip -o $FEDORA_GSEARCH_NAME.zip</code>  

<code>cp $FEDORA_GSEARCH_NAME/fedoragsearch.war $CATALINA_HOME/webapps/ && unzip -o $FEDORA_GSEARCH_NAME/fedoragsearch.war -d $CATALINA_HOME/webapps/fedoragsearch && rm -rf $FEDORA_GSEARCH_NAME*</code>  

<code>wget $SOLR_URL</code>  

<code>tar -xf $SOLR_NAME.tgz</code>  

<code>cp -r $SOLR_NAME/example/solr $FEDORA_HOME/solr</code>

<code>cp $SOLR_NAME/example/webapps/solr.war $CATALINA_HOME/webapps/ && unzip -o $SOLR_NAME/example/webapps/solr.war -d $CATALINA_HOME/webapps/solr</code>  

<code>mkdir $FEDORA_HOME/solr/$SOLR_DEFAULT_CORE_PATH/data</code>  

<code>chown -R $FEDORA_USER:$FEDORA_USER $FEDORA_HOME</code>  

<code>cd $CATALINA_HOME/webapps/fedoragsearch/FgsConfig</code>

_Ant generateIndexingXslt_  

<code>ant -f fgsconfig-basic.xml -Dlocal.FEDORA_HOME=$FEDORA_HOME -DgsearchUser=$FEDORA_ADMIN_USER -DgsearchPass=$FEDORA_ADMIN_PASS -DfinalConfigPath=$CATALINA_HOME/webapps/fedoragsearch/WEB-INF/classes -DlogFilePath=$FEDORA_HOME/server/logs -DfedoraUser=$FEDORA_ADMIN_USER -DfedoraPass=$FEDORA_ADMIN_PASS -DobjectStoreBase=$FEDORA_HOME/data/objectStore -DindexDir=$FEDORA_HOME/solr/$SOLR_DEFAULT_CORE_PATH/data/index -DindexingDocXslt=foxmlToSolr -propertyfile fgsconfig-basic-for-islandora.properties</code>
<code>mv $FEDORA_HOME/solr/$SOLR_DEFAULT_CORE_PATH/conf/schema.xml $FEDORA_HOME/solr/$SOLR_DEFAULT_CORE_PATH/conf/schema.xml.bak</code>  

<code>mv $FEDORA_HOME/solr/$SOLR_DEFAULT_CORE_PATH/conf/solrconfig.xml $FEDORA_HOME/solr/$SOLR_DEFAULT_CORE_PATH/conf/solrconfig.xml.bak</code>  

<code>mv $CATALINA_HOME/webapps/fedoragsearch/WEB-INF/classes/fgsconfigFinal/index/FgsIndex/foxmlToSolr.xslt $CATALINA_HOME/webapps/fedoragsearch/WEB-INF/classes/fgsconfigFinal/index/FgsIndex/foxmlToSolr.xslt.bak  
</code>

_Solr Configuration_ 
 
<code>cd ~</code>  

<code>git clone git://github.com/discoverygarden/basic-solr-config.git</code>  

<code>cd basic-solr-config</code>  

<code>git checkout 4.x</code>  

<code>mv ~/basic-solr-config/conf/* $FEDORA_HOME/solr/$SOLR_DEFAULT_CORE_PATH/conf</code>  

<code>mv ~/basic-solr-config/islandora_transforms $CATALINA_HOME/webapps/fedoragsearch/WEB-INF/classes/fgsconfigFinal/index/FgsIndex</code>  

<code>mv ~/basic-solr-config/foxmlToSolr.xslt $CATALINA_HOME/webapps/fedoragsearch/WEB-INF/classes/fgsconfigFinal/index/FgsIndex/foxmlToSolr.xslt</code>  

<code>cp ~/basic-solr-config/index.properties $CATALINA_HOME/webapps/fedoragsearch/WEB-INF/classes/fgsconfigFinal/index/FgsIndex/index.properties</code>  

<code>cd ~</code>  

<code>rm -rf ~/basic-solr-config</code>  

<code>rm -rf ~/$SOLR_NAME*</code>  

<code>cd $CATALINA_HOME/webapps/fedoragsearch/WEB-INF/lib</code>  

<code>wget https://github.com/discoverygarden/dgi_gsearch_extensions/releases/download/v0.1.1/gsearch_extensions-0.1.1-jar-with-dependencies.jar -O gsearch_extensions-0.1.1-jar-with-dependencies.jar </code>

### GSearch Multithreading

_OPTIONAL: Only need to use if you want multithreading and you have multiple cores. This allows multithreaded gsearch updates for better performance. Recommend adding one Fgsupdater per core._

<code>sed -i '0,/    <param name="type" value="topic">/s//    <param name="type" value="queue">/' $FEDORA_HOME/server/config/fedora.fcfg</code>  

<code>sed -i 's|topic.fedoraAPIM|queue.fedoraAPIM|g' $CATALINA_HOME/webapps/fedoragsearch/WEB-INF/classes/fgsconfigFinal/updater/FgsUpdaters/updater.properties</code>  

<code>cp -r $CATALINA_HOME/webapps/fedoragsearch/WEB-INF/classes/fgsconfigFinal/updater/FgsUpdaters $CATALINA_HOME/webapps/fedoragsearch/WEB-INF/classes/fgsconfigFinal/updater/FgsUpdater1</code>  

<code>sed -i 's|fedoragsearch0|fedoragsearch1|g' $CATALINA_HOME/webapps/fedoragsearch/WEB-INF/classes/fgsconfigFinal/updater/FgsUpdater1/updater.properties</code>  

<code>sed -i "s|FgsUpdaters|$GSEARCH_UPDATER_NAMES|g" $CATALINA_HOME/webapps/fedoragsearch/WEB-INF/classes/fgsconfigFinal/fedoragsearch.properties</code>

### Adore-Djatoka

<b>Install djatoka war</b>  

<code>cp /opt/adore-djatoka/dist/adore-djatoka.war $CATALINA_HOME/webapps && unzip -o /opt/adore-djatoka/dist/adore-djatoka.war -d $CATALINA_HOME/webapps/adore-djatoka  </code>

<b>Setup Logging</b>
_Please note logging still needs some TLC log4j and logrotate clash with some files_ 
 
<code>cd ~</code>  

<code>git clone https://github.com/discoverygarden/islandora_log_config.git</code>  

<code>cd islandora_log_config</code>  

<code>cp islandora_logrotate /etc/logrotate.d/</code>  

<code>cp log4j.xml /usr/local/fedora/tomcat/webapps/fedoragsearch/WEB-INF/classes/log4j.xml</code>  

<code>cp logging.properties /usr/local/fedora/tomcat/conf/logging.properties</code>  

<code>cp log4j.properties /usr/local/fedora/tomcat/webapps/adore-djatoka/WEB-INF/classes/log4j.properties</code>  

<code>chown -R $FEDORA_USER:$FEDORA_USER $FEDORA_HOME</code>  


### Drupal Filter

<b>Setup Drupal filter</b>  

<code>cd $CATALINA_HOME/webapps/fedora/WEB-INF/lib</code>  

<code>wget --no-check-certificate $DRUPAL_FILTER_URL  

<code>echo -e 'fedora-auth\n{\n\torg.fcrepo.server.security.jaas.auth.module.XmlUsersFileModule required\n\tdebug=true; \n\tca.upei.roblib.fedora.servletfilter.DrupalAuthModule required\n\tdebug=true; \n};\n\nfedora-auth-xmlusersfile\n{\n\torg.fcrepo.server.security.jaas.auth.module.XmlUsersFileModule required\n\tdebug=true;\n};\n\nfedora-auth-ldap-bind\n{\n\torg.fcrepo.server.security.jaas.auth.module.LdapModule required\n\thost.url="ldap://dev01.muradora.org"\n\tauth.type="simple"\n\tbind.mode="bind"\n\tbind.filter="uid={0},ou=people,dc=muradora,dc=org"\n\tdebug=true;\n};\n\nfedora-auth-ldap-bind-search-bind\n{\n\torg.fcrepo.server.security.jaas.auth.module.LdapModule required\n\thost.url="ldap://dev01.muradora.org"\n\tauth.type="simple"\n\tbind.mode="bind-search-bind"\n\tbind.user="uid=binduser,ou=people,dc=muradora,dc=org"\n\tbind.pass="murabind"\n\tsearch.base="ou=people,dc=muradora,dc=org"\n\tsearch.filter="(uid={0})"\n\tattrs.fetch="cn,sn,mail,displayName,carLicense"\n\tdebug=true;\n};\n\nfedora-auth-ldap-bind-search-compare\n{\n\torg.fcrepo.server.security.jaas.auth.module.LdapModule required\n\thost.url="ldap://dev01.muradora.org"\n\tauth.type="simple"\n\tbind.mode="bind-search-compare"\n\tbind.user="uid=binduser,ou=people,dc=muradora,dc=org"\n\tbind.pass="murabind"\n\tsearch.base="ou=people,dc=muradora,dc=org"\n\tsearch.filter="(uid={0})"\n\tattrs.fetch="cn,sn,mail,displayName,carLicense"\n\tdebug=true;\n};' > $FEDORA_HOME/server/config/jaas.conf </code> 

<code>cd $FEDORA_HOME/server/config</code>  

<code>wget https://raw.github.com/Islandora/islandora_drupal_filter/master/filter-drupal.xml</code>  

<code>sed -i "s|DB_SERVER|$DB_SERVER|g" $FEDORA_HOME/server/config/filter-drupal.xml</code>  

<code>sed -i "s|DRUPAL_DB_NAME|$DRUPAL_DB_NAME|g" $FEDORA_HOME/server/config/filter-drupal.xml</code>  

<code>sed -i "s|DRUPAL_DB_USER|$DRUPAL_DB_USER|g" $FEDORA_HOME/server/config/filter-drupal.xml</code>  

<code>sed -i "s|DRUPAL_DB_PASS|$DRUPAL_DB_PASS|g" $FEDORA_HOME/server/config/filter-drupal.xml</code>

<b>Start fedora fully configured</b>  

<code>chown -R $FEDORA_USER:$FEDORA_USER $FEDORA_HOME</code>  

<code>service tomcat start  </code>

### Install Drupal  

<b>CLUI Config</b>  

_Please note some libraries, modules, contrib are optional but are included to support additional theming. e.g. features, strongarm, node_export_ 
 
<code>cd $OS_DEFAULT_DOCUMENTROOT </code> 

<code>drush dl drupal</code>  

<code>mv drupal-7* drupal7</code>  

<code>cd drupal7</code>  

<code>mkdir sites/default/files</code>  

<code>mkdir sites/all/{modules,themes,libraries}</code>  

<code>cp sites/default/default.settings.php sites/default/settings.php</code>

<code>cd sites/all/modules</code>  


### Islandora Modules  

_Git clone the following modules:_  

_modslist.sh helper script to handle the git repos to install modules_  

<code>#!/bin/bash</code>  
<code>cd /var/www/drupal7/sites/all/modules</code>

<code>git clone https://github.com/Islandora/islandora.git</code> 
 
<code>git clone https://github.com/Islandora/islandora_scholar.git</code> 
 
<code>git clone https://github.com/discoverygarden/google_analytics_reports.git</code> 
 
<code>git clone https://github.com/discoverygarden/islandora_ga_reports.git</code> 
 
<code>git clone https://github.com/Islandora/islandora_solr_search.git </code> 

<code>git clone https://github.com/Islandora/islandora_solr_views.git</code>  

<code>git clone https://github.com/Islandora/islandora_solution_pack_collection.git </code> 

<code>git clone https://github.com/Islandora/objective_forms.git  </code>

<code>git clone https://github.com/Islandora/islandora_xml_forms.git</code>  

<code>git clone https://github.com/Islandora/php_lib.git  </code>

<code>git clone https://github.com/Islandora/islandora_importer.git </code> 

<code>git clone https://github.com/Islandora/islandora_bookmark.git</code> 
 
<code>git clone https://github.com/Islandora/islandora_oai.git  </code>

<code>git clone https://github.com/Islandora/islandora_solution_pack_audio.git</code> 
 
<code>git clone https://github.com/Islandora/islandora_solution_pack_book.git</code>
  
<code>git clone https://github.com/Islandora/islandora_solution_pack_image.git </code>
 
<code>git clone https://github.com/Islandora/islandora_solution_pack_large_image.git </code>
 
<code>git clone https://github.com/Islandora/islandora_solution_pack_pdf.git </code> 

<code>git clone https://github.com/Islandora/islandora_solution_pack_video.git</code>  

<code>git clone https://github.com/Islandora/islandora_paged_content.git </code> 

<code>git clone https://github.com/Islandora/islandora_internet_archive_bookreader.git</code> 
 
<code>git clone https://github.com/Islandora/islandora_ocr.git</code>  

<code>git clone https://github.com/Islandora/islandora_openseadragon.git</code>  

<code>git clone https://github.com/Islandora/islandora_jwplayer.git </code> 

<code>git clone https://github.com/Islandora/islandora_fits.git </code> 

<code>git clone https://github.com/Islandora/islandora_simple_workflow.git </code> 

<code>git clone https://github.com/Islandora/islandora_book_batch.git </code> 

<code>git clone https://github.com/Islandora/islandora_batch.git  </code>

<code>git clone https://github.com/Islandora/islandora_ip_embargo.git </code> 

<code>git clone https://github.com/Islandora/islandora_solution_pack_compound.git</code> 
 
<code>git clone https://github.com/Islandora/islandora_solution_pack_newspaper.git </code> 

<code>git clone https://github.com/Islandora/islandora_xacml_editor.git  </code>

<code>git clone https://github.com/Islandora/islandora_marcxml.git  </code>

<code>git clone https://github.com/discoverygarden/islandora_featured_collection.git</code>  

<code>git clone https://github.com/Islandora/islandora_solr_metadata.git </code> 

<code>git clone https://github.com/discoverygarden/solrmetadataconfigs.git </code> 

<code>git clone https://github.com/discoverygarden/islandora_solution_pack_document.git</code> 
 
<code>git clone https://github.com/discoverygarden/islandora_jodconverter.git  </code>

<code>git clone https://github.com/discoverygarden/islandora_plupload.git  </code>

<code>git clone https://github.com/discoverygarden/islandora_solution_pack_entities.git </code>
 
<code>git clone https://github.com/Islandora-Labs/islandora_binary_object.git </code> 

<code>git clone https://github.com/Islandora/islandora_checksum.git </code> 

<code>git clone https://github.com/Islandora/islandora_checksum_checker.git </code> 

<code>git clone https://github.com/Islandora/islandora_premis.git  </code>

<code>git clone https://github.com/Islandora/islandora_bagit.git</code>

_Dependency if bagit is to be used_ 
 
<code>/usr/bin/pear install Archive_Tar  </code>

### Libraries 
 
<code>cd /var/www/drupal7/sites/all/libraries/</code>  

<code>git clone -b $TUQUE_BRANCH git://github.com/Islandora/tuque.git </code> 

<code>git clone  https://github.com/Islandora/internet_archive_bookreader.git bookreader</code>  

<code>wget http://openseadragon.github.io/releases/openseadragon-bin-0.9.129.zip  && unzip openseadragon-bin-0.9.129.zip && rm -rf openseadragon-bin-0.9.129.zip && mv openseadragon-bin-0.9.129 openseadragon</code>

<code>wget http://www.longtailvideo.com/download/jwplayer-3359.zip && unzip -o jwplayer-3359.zip && rm -rf jwplayer-3359.zip</code>
NOTE: link no longer available. You can sign up to obtain this but unsure of licensing requirements needs to be discussed
<code>wget https://github.com/moxiecode/plupload/archive/v1.5.8.zip -O v1.5.8.zip && unzip -o v1.5.8.zip && rm -rf v1.5.8.zip && mv plupload-1.5.8 plupload</code>  

<code>wget http://sourceforge.net/projects/jodconverter/files/JODConverter/2.2.2/jodconverter-2.2.2.zip/download -O jodconverter-2.2.2.zip && unzip -o jodconverter-2.2.2.zip && rm -rf jodconverter-2.2.2.zip </code> 

<code>mkdir jquery.cycle && cd jquery.cycle && wget http://malsup.github.com/jquery.cycle.all.js</code>  

<code>drush dl imagemagick libraries views ctools oauth chart google_analytics views_slideshow views_responsive_grid strongarm features designkit conditional_styles socialmedia widgets features_extra uuid node_export block_class ldap entity colorbox rules xmlsitemap css_injector</code>  

### Drupal site install

_Please note that you should consider making the drupal directory permissions more secure. These permissions will allow you to install modules through the drupal web interface however if this functionality is not required recommend locking down permissions using something such as https://github.com/discoverygarden/secure_drupal_file after the install._ 
  
<code>chown -R $APACHE_USER:$APACHE_USER /var/www/drupal7 </code> 

<code>drush -y site-install standard --account-name=$DRUPAL_ADMIN_USER --account-pass=$DRUPAL_ADMIN_PASS --db-url=mysql://$DRUPAL_DB_USER:$DRUPAL_DB_PASS@localhost/$DRUPAL_DB_NAME  </code>

<b>Secure settings.php</b> 
 
<code>chmod 444 /var/www/drupal7/sites/default/settings.php</code>

### Drush Enables and Configuration  

<code>drush en block color comment contextual dashboard dblog field field_sql_storage field_ui file filter help image list menu node number options overlay path rdf shortcut system taxonomy text toolbar user bartik seven imagemagick libraries views update ctools oauth_common oauth_common_providerui system_charts chart_views chart googleanalytics views_responsive_grid strongarm features designkit conditional_styles fe_block uuid node_export node_export_features widgets socialmedia block_class colorbox rules entity_token css_injector</code>

<code>drush -y colorbox-plugin </code> 

<code>drush -y dis overlay  </code>

<code>drush vset islandora_base_url "$ISLANDORA_BASE" </code> 

<code>drush vset islandora_solr_url "$SOLR_BASE" </code> 

<code>drush -y --user=1 en islandora islandora_audio islandora_basic_collection islandora_basic_image islandora_fits islandora_importer islandora_openseadragon islandora_simple_workflow islandora_video islandora_jwplayer islandora_pdf  islandora_paged_content islandora_ocr islandora_internet_archive_bookreader islandora_large_image islandora_book islandora_batch islandora_book_batch xml_form_api xml_form_elements xml_schema_api objective_forms php_lib islandora_solr islandora_solr_config islandora_solr_views islandora_ga_reports islandora_scholar islandora_oai google_analytics_reports islandora_importer xml_form_builder xml_forms islandora_bibliography islandora_scholar_embargo islandora_google_scholar islandora_marcxml islandora_xacml_editor islandora_xacml_api zip_importer pmid_importer ris_importer islandora_bookmark doi_importer endnotexml_importer citation_exporter bartik seven imagemagick libraries views views_ui ctools csl citeproc oauth_common oauth_common_providerui system_charts chart_views chart googleanalytics islandora_compound_object islandora_ip_embargo islandora_newspaper views_slideshow views_slideshow_cycle islandora_featured_collection islandora_solr_metadata islandora_document islandora_jodconverter islandora_entities islandora_entities_csv_import islandora_binary_object</code>

<code>drush php-eval "variable_set('islandora_large_image_viewers', array('name' => array('none' => 'none', 'islandora_openseadragon' => 'islandora_openseadragon'),'default' => 'islandora_openseadragon'));" </code> 

<code>drush php-eval "variable_set('islandora_video_viewers', array('name' => array('none' => 'none', 'islandora_jwplayer' => 'islandora_jwplayer'),'default' => 'islandora_jwplayer'));"</code>  

<code>drush php-eval "variable_set('islandora_audio_viewers', array('name' => array('none' => 'none', 'islandora_jwplayer' => 'islandora_jwplayer'),'default' => 'islandora_jwplayer'));"</code> 

<code>drush php-eval "variable_set('islandora_book_viewers', array('name' => array('none' => 'none', 'islandora_internet_archive_bookreader' => 'islandora_internet_archive_bookreader'), 'default' => 'islandora_internet_archive_bookreader'));"</code>  

<code>drush php-eval "variable_set('islandora_book_page_viewers', array('name' => array('none' => 'none', 'islandora_openseadragon' => 'islandora_openseadragon'), 'default' => 'islandora_openseadragon'));" </code> 

<code>drush php-eval "variable_set('islandora_newspaper_page_viewers', array('name' => array('none' => 'none', 'islandora_openseadragon' => 'islandora_openseadragon'),'default' => 'islandora_openseadragon'))"</code>  

<code>drush php-eval "variable_set('islandora_newspaper_issue_viewers', array('name' => array('none' => 'none', 'islandora_internet_archive_bookreader' => 'islandora_internet_archive_bookreader'),'default' => 'islandora_internet_archive_bookreader'))"</code>  

<code>drush vset islandora_pdf_create_fulltext "1"  </code>

<code>drush vset islandora_pdf_path_to_pdftotext `which pdftotext`</code>  

<code>drush vset islandora_metadata_display "islandora_solr_metadata"</code>  

<code>drush vset islandora_fits_executable_path "/opt/fits/fits.sh" </code> 

<code>drush vset islandora_book_tesseract `which tesseract`</code>  

<code>drush vset islandora_ocr_tesseract `which tesseract`</code>  

<code>drush vset islandora_batch_java `which java`</code>  

<code>drush php-eval "variable_set('islandora_ocr_tesseract_enabled_languages', array('deu-frak' => deu-frak, 'eng' => eng, 'fra' => fra, 'ita' => ita, 'jpn' => jpn, 'por' => por, 'spa' => spa, 'dan-frak' => 0, 'deu' => 0, 'hin' => 0, 'ita_old' => 0, 'rus' => 0, 'slk-frak' => 0, 'spa_old' => 0));" </code> 

<code>drush vset islandora_lame_url `which lame` </code> 

<code>drush vset islandora_video_ffmpeg_path `which ffmpeg`</code>  

<code>drush vset islandora_video_ffmpeg2theora_path `which ffmpeg2theora` </code> 

<code>drush vset islandora_paged_content_gs `which gs`</code>  

<code>drush vset imagemagick_convert `which convert`</code>  

<code>drush vset islandora_document_create_fulltext "1"  </code>

<code>drush vset islandora_document_path_to_pdftotext `which pdftotext` </code> 

<code>drush vset site_name "Stock Islandora and Fedora"</code>  

<code>drush vset image_toolkit "imagemagick"</code>  

<code>drush vset error_level $ERROR_LEVEL</code>  

<code>drush php-eval "variable_set('oai2_date_field', 'fgs_lastModifiedDate_dt')"</code>

_<b>NOTE This should be a publicly resolvable URL or viewers will not work for people who cannot resolve the name. You also should ensure that the /etc/hosts file is pointing the name at localhost</b>_
  
<code>drush vset islandora_paged_content_djatoka_url "http://hostname/adore-djatoka/"</code>  

<code>drush vset user_register 0 </code> 

<code>drush -y updb</code>  

<code>drush -y cc all</code>  

<code>service $APACHE_SERVICE restart</code>  

<code>drush cc all</code>

### Follow-up Notes

_More tesseract languages can be found here:_ [https://code.google.com/p/tesseract-ocr/downloads/list](https://code.google.com/p/tesseract-ocr/downloads/list)

_Recommend locking down Drupal permissons on Production_ e.g. run something like https://github.com/discoverygarden/secure_drupal_file

_Keep server firewalled_ Don't expose any ports to the Internet asides from 80/443. Port 8080 should be kept locked down to localhost only. 